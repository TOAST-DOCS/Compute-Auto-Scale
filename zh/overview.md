## 计算 > 弹性伸缩 > 概要

弹性伸缩(auto scale)是指持续监控实例的负荷，有必要时增加或减少实例，通过弹性伸缩实时调整负荷，能够给用户提供稳定、有弹性的服务。

弹性伸缩由实例模板和伸缩组来构成。

## 实例模板
实例模板是指被自动创建的实例属性。通常要设置创建实例时必要的项目。除此之外，也可以设置弹性IP及增加的量。也可以用实例模板创建实例时运行的用户自定义的脚本。

> [参考] 实例模板的作用仅是保存设置值。
> 只创建实例模板，并不能创建一个实例。

## 伸缩组
伸缩组定义的是增加或减少实例的条件和当满足条件时执行的动作。通常
伸缩组由对投入实例的最小，最大设置值和增加, 减少的(scale out, scale in) 策略来构成。

### 最小、最大、投入实例
最小、最大、投入实例必须要在伸缩组中定义参数。其每个参数代表的意思如下。

- 最小、最大实例: 伸缩组可创建的实例数量的最小值和最大值。
- 投入实例: 伸缩组创建并投入中的实例的数量。 当此值发生变化时将调整实例的数量。

当最小、最大、投入实例为1, 10, 2的时候，最初的时候根据投入实例会创建2台实例。之后根据负荷状况来启动增加或减少的策略，随之投入实例将会增加或减少。投入实例在任何情况下也不能超出最少、最大实例指定的范围。

### 策略
策略是指创建或删除实例的基准，是由一个以上条件和当满足条件时执行的动作来构成。
策略的条件是由实例的性能指标，基准值，持续时间来构成。伸缩组使用的实例的性能指标如下。

- CPU使用率(%)
- 内存使用率(%)
- 磁盘每分钟的读写量(KB/m)
- 网络每分钟的传输接收量(KB/m)

伸缩组对以上的性能指标每分钟收集一次。收集后的性能指标以伸缩组单位来管理。 最终弹性伸缩确认的值是伸缩组内所有实例的平均值。

> [注意]只有一个特定实例满足条件时不启动策略。
>
> 伸缩组实时观察指定的性能指标在持续时间中是否超过基准值，判断是否启动策略。例如：条件为CPU使用率在90%以上，持续时间为5分钟时，在这5分钟之内 使用率不低于90%才能启动策略。

满足指定条件时启动策略，伸缩组根据条件执行相应的动作。具体来讲动作就是调整伸缩组的投入实例数量。投入实例的数量增加的叫做**增加策略**、减少的叫做 **减少策略**。

> [参考] 启动减少策略时最先终止的是时间最长的实例。 为实例终止时发生的信号(Linux：[SIGTERM/SIGKILL](https://www.freedesktop.org/software/systemd/man/systemd.service.html), Windows：[WM_QUERYENDSESSION](https://msdn.microsoft.com/en-us/library/windows/desktop/aa376890.aspx)/[WM_ENDSESSION](https://msdn.microsoft.com/en-us/library/windows/desktop/aa376889.aspx)) 执行处理程序，以便服务在无中断的情况下终止。

为防止满足条件的动作不受限制的执行，设置待机时间 (cooldown time)。从最后执行动作的时间至待机时间之内即使满足条件也不启动策略。

举例说明待机时间。

首先，假设增加策略为 _"CPU使用率在90%以上维持5分钟时增加2个投入 实例"。如果实际实例的CPU使用率在90%以上维持了6分钟，这时过5分钟后创建2个实例。之后再过1分钟又满足了CPU使用率在90%维持了5分钟的条件，因此创建2个新的实例。

如果没有待机时间，用户可能意外地遇到实例增加或减少的情况。为有效利用资源请合理设置待机时间。

> [参考] 在伸缩组即可设置增加策略和减少策略的待机时间。
> 通常情况下增加策略的待机时间设置尽可能要短，以应对紧急增加的负荷，减少策略的待机时间设置尽可能要充足，以应对缓慢的把实例从服务中移除。要实时监控服务的负荷设定适当策略才能防止实例的浪费。

<br>

> [注意]为防止增加、减少策略同时启动，伸缩组也要设置待机时间。伸缩组的待机时间与增加，减少策略待机时间中的最小值相同。

### 负载均衡
创建实例后指定要连接的负载均衡，启动增加策略时创建的实例将连接到指定的负载均衡。这样可以对新创建的实例利用负载均衡流畅地分配负荷，立即投入使用。

> [参考] 新创建的实例实际投入到服务的时间是，开机后启动用户服务，对负载均衡的状态确认正常响应之后。

## 使用场景
伸缩组根据已设置的策略自动增加或减少。但有必要时用户可以手动调整投入实例。弹性伸缩支持的调整种类如下。

- 策略调整<br>
  按照伸缩组指定的策略来调整实例的数量。是伸缩组的基本动作。

- 用户调整<br>
  用户在控制台启动增加、减少策略的方式。即使不满足增加, 减少策略的启动条件也可以执行。

- 预约调整<br>
  把实例的性能指标作为基准，在每个特定的时间调整投入实例的数量。启动时间可以设置为只发生1次或周期性反复发生。


