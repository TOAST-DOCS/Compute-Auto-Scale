## Compute > Auto Scale > 개요

TOAST의 오토스케일은 인스턴스의 부하를 지속적으로 모니터링하여 필요한 경우 인스턴스를 추가로 생성하거나 삭제하는 상품입니다.
오토스케일을 통해 탄력적으로 서비스 부하에 대응하여 안정적이고 탄력적인 사용자 서비스를 제공할 수 있습니다.

TOAST의 오토스케일은 인스턴스 템플릿과 스케일링 그룹으로 구성됩니다.

### 인스턴스 템플릿
인스턴스 템플릿은 자동으로 생성될 인스턴스의 속성입니다.
기본적으로 인스턴스 생성시 필요한 항목들을 설정해야 합니다.
여기에 더해 플로팅 IP와 추가 볼륨을 붙이도록 설정할 수 있고, 인스턴스 템플릿에 의해서 생성된 인스턴스가 최초 구동시 수행할 사용자 스크립트를 추가할 수 있습니다.

> [참고] 인스턴스 템플릿의 역할은 단순히 설정값을 보관하는 것입니다.
> 인스턴스 템플릿을 생성하는 것만으로 인스턴스가 생성되지 않습니다.

### 스케일링 그룹
스케일링 그룹은 인스턴스를 추가로 생성/삭제할 조건과 생성/삭제 시 수행할 행동에 대한 정의입니다.
구체적으로 스케일링 그룹에서는 다음과 같은 항목을 정의합니다.

#### 기본 정보
스케일링 그룹의 이름과 사용할 인스턴스 템플릿을 지정합니다.
또한 무제한으로 인스턴스를 생성하거나 모든 인스턴스를 제거하지 않도록 최소/최대/구동 인스턴스를 설정합니다.

예를 들어 최소/최대/구동 인스턴스가 각각 1, 10, 2인 경우, 처음에 두 대의 인스턴스가 생성되었다가 부하가 없으면 인스턴스 한 대만 남겨둡니다.
만약 부하가 증가한다면 인스턴스를 최대 열 대까지 생성하게 됩니다.

#### 정책
스케일링 그룹이 인스턴스를 생성하거나 제거하는 조건을 정의합니다. TOAST의 스케일링 그룹에서 인스턴스를 생성/제거하는 조건을 각각 **확장 정책**/**감축 정책** 이라고 합니다. 스케일링 그룹은 확장/감축 정책이 반드시 1개 이상씩 존재해야 하며, 여러 개의 정책을 AND 또는 OR 연산자로 묶어서 사용할 수 있습니다.

> [참고] 감축 정책이 발동되면 가장 오래된 인스턴스부터 삭제합니다.

확장/감축 정책에서 사용하는 인스턴스 성능 지표는 다음과 같습니다.
  * CPU 사용률 (%)
  * 메모리 사용률 (%)
  * 디스크 초당 읽기/쓰기량 (byte/s)
  * 네트워크 초당 송신/수신량 (byte/s)

스케일링 그룹은 지정된 성능 지표들을 1분 주기로 수집합니다.
수집된 성능 지표들을 스케일링 그룹 단위로 관리됩니다.
최종적으로 오토스케일 상품이 확인하는 값은 스케일링 그룹내 모든 인스턴스들의 평균 값입니다.

> [주의] 특정 인스턴스 하나만 조건을 만족하는 경우에는 스케일링 정책이 발동하지 않습니다.

확장/감축 정책은 지정된 성능 지표가 조건 지속 시간 동안 기준값을 초과하는 경우 발동합니다.
예를 들어 조건이 CPU 사용률이 90% 이상이고 조건 지속 시간이 5분인 경우, 5분 동안 CPU 사용율이 90% 아래로 떨어지지 않아야 해당 정책이 발동합니다.
백그라운드 쓰레드의 실행이나 일시적인 부하에도 민감하게 반응하게 된다면 불필요한 인스턴스 생성이 발생하기 때문에 조건 지속 시간을 적절하게 설정해야 합니다.

또한 TOAST의 스케일링 그룹은 쿨다운 시간을 두어 정책이 빈번하게 발동하는 것을 방지하고 있습니다.
즉, 마지막으로 정책을 발동한 시간으로부터 쿨다운 시간 동안은 조건을 충족하더라도 정책을 발동하지 않습니다.

> [참고] 스케일링 그룹에서 확장 정책과 감축 정책의 쿨다운 시간을 각각 지정할 수 있도록 되어 있습니다.
> 보통 확장 정책의 쿨다운은 갑작스러운 부하 증가에 대응할 수 있도록 가능한 짧게 두고, 축소 정책의 쿨다운은 천천히 인스턴스를 서비스에서 제외하도록 가능한 길게 둡니다.
> 서비스의 부하 상황을 꾸준히 모니터링하여 적절한 정책을 설정해야 인스턴스가 낭비되는 것을 막을 수 있습니다.

#### 로드밸런서
인스턴스 생성 후 연결할 TOAST 로드밸런서를 지정합니다.
확장 정책이 발동되었을 때 생성된 인스턴스들은 스케일링 그룹에 지정된 로드밸런서에게 연결됩니다.
로드밸런서 상품과 연계하면 생성된 인스턴스들을 추가 작업없이 즉시 서비스에 투입할 수 있습니다.

> [참고] 실제로 생성된 인스턴스가 서비스에 투입되는 시점은 부팅 완료 후 사용자 서비스가 정상적으로 기동되어 로드밸런서의 상태 확인에 정상적으로 응답한 이후 입니다.

### 사용 시나리오
스케일링 그룹을 생성하면 즉시 인스턴스 템플릿에 따라 인스턴스들이 생성됩니다.
기본적으로 스케일링 그룹은 설정된 정책들을 따라 자동으로 확장/감축을 수행합니다.
그러나 필요한 경우 사용자가 명시적으로 확장/감축을 조정할 수 있습니다.
TOAST의 오토스케일에서 지원하는 조정의 종류는 다음과 같습니다.

* 정책에 의한 조정<br>
  스케일링 그룹에서 지정한 정책대로 인스턴스의 수를 조정합니다.
  스케일링 그룹의 기본적인 동작입니다.

- 사용자에 의한 조정<br>
  사용자가 콘솔에서 확장/축소 명령을 내리는 방식입니다.
  확장/감축 정책의 발동 조건을 만족하지 않아도 수행됩니다.

- 예약에 의한 조정<br>
  인스턴스의 성능 지표를 기준으로 하는 대신 특정 시점에 마다 확장/축소 정책을 발동하는 방식입니다.
  발동 시간은 단 한번만 일어나도록 설정할 수도 있고, 주기적으로 반복해서 일어나도록 설정할 수 있습니다.
