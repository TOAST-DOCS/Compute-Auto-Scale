## Compute > Auto Scale > 개요

TOAST의 오토스케일은 부하의 정도에 따라 인스턴스를 추가 혹은 삭제해주는 상품입니다.
오토스케일을 사용하면 인스턴스의 상태를 지속적으로 모니터링하여 인스턴스를 확장 또는 감축하여 탄력적으로 서비스 부하에 대응합니다.
이를 통해 안정적이고 탄력적인 사용자 서비스를 제공할 수 있습니다.

TOAST의 오토스케일은 인스턴스 템플릿과 스케일링 그룹으로 구성됩니다.

### 인스턴스 템플릿
인스턴스 템플릿은 자동으로 생성될 인스턴스의 속성입니다.
기본적으로 인스턴스 생성시 필요한 항목들과 플로팅 IP 및 추가 볼륨의 유무에 대해서 설정할 수 있습니다.
다음에 설명할 스케일링 그룹에 인스턴스 템플릿을 등록해두면, 스케일링 그룹에 의해 해당 속성을 가진 인스턴스들이 생성됩니다.

> [참고] 인스턴스 템플릿의 역할은 단순히 설정값을 보관하는 것입니다.
> 인스턴스 템플릿을 생성하는 것만으로 인스턴스가 생성되지 않습니다.

### 스케일링 그룹
스케일링 그룹은 인스턴스 확장/감축 정책에 대한 정의입니다.
구체적으로 스케일링 그룹에서는 다음과 같은 항목을 정의합니다.

#### 기본 정보
스케일링 그룹의 이름과 사용할 인스턴스 템플릿을 지정합니다. 또한 무제한으로 인스턴스를 생성하거나 모든 인스턴스를 제거하지 않도록 최소/최대/구동 인스턴스를 설정합니다.

예를 들어 최소/최대/구동 인스턴스가 각각 1, 10, 2인 경우를 가정합니다.
처음에 두 대의 인스턴스가 생성되었다가 부하가 없으면 인스턴스 한 대만 남겨둡니다.
만약 부하가 증가한다면 인스턴스를 최대 열 대까지 생성합니다.

#### 정책
스케일링 그룹이 인스턴스를 생성하거나 제거하는 조건을 정의합니다. TOAST의 스케일링 그룹에서 인스턴스를 생성/제거하는 조건을 각각 **확장 정책**/**감축 정책** 이라고 합니다. 스케일링 그룹은 확장/감축 정책이 반드시 1개 이상씩 존재해야 하며, 여러 개의 정책을 AND 또는 OR 연산자로 묶어서 사용할 수 있습니다.

> [참고] 감축 정책이 발동되면 가장 오래된 인스턴스부터 삭제합니다.

확장/감축 정책에서 사용하는 인스턴스 부하 지표는 다음과 같습니다.
  * CPU 사용률 (%)
  * 메모리 사용률 (%)
  * 디스크 초당 읽기/쓰기량 (byte/s)
  * 네트워크 초당 송신/수신량 (byte/s)

> [주의] 스케일링 정책 발동 기준이 되는 지표는 스케일링 그룹이 생성한 모든 인스턴스들에서 얻어진 지표의 평균값입니다.
> 특정 인스턴스 하나만 조건을 만족한다고 해서 스케일링 정책이 발동하지 않습니다.

확장/감축 정책은 지정된 지표가 일정시간 동안 기준값을 초과하는 경우 발동합니다.
예를 들어 조건이 CPU 사용률이 90% 이상이고 조건 지속 시간이 5분인 경우, 5분 동안 CPU 사용율이 90% 아래로 떨어지지 않아야 해당 정책이 발동합니다.
백그라운드 쓰레드의 실행이나 일시적인 부하에도 민감하게 반응하게 된다면, 불필요한 인스턴스 생성이 발생하기 때문입니다.

또한 TOAST이 스케일링 그룹은 쿨다운 시간을 두어 정책이 빈번하게 발동하는 것을 방지하고 있습니다.
즉, 마지막으로 정책을 발동한 시간으로부터 쿨다운 시간 동안은 조건을 충족하더라도 정책을 발동하지 않습니다.

> [참고] TOAST의 스케일링 그룹은 확장 정책과 감축 정책의 쿨다운 시간을 각각 지정할 수 있도록 되어 있습니다.
> 보통 확장 정책의 쿨다운은 갑작스러운 부하 증가에 대응할 수 있도록 가능한 짧게 두고, 축소 정책의 쿨다운은 천천히 인스턴스를 서비스에서 제외하도록 가능한 길게 둡니다.
> 서비스의 부하 상황을 꾸준히 모니터링하여 적절한 정책을 설정해야 인스턴스가 낭비되는 것을 막을 수 있습니다.

#### 로드밸런서
인스턴스 생성 후 연결할 로드밸런서를 지정합니다.

확장 정책이 발동되었을 때 생성된 인스턴스들은 스케일링 그룹에 지정된 로드밸런서에게 연결됩니다.

### 사용 시나리오
스케일링 그룹 생성 후 투입된 인스턴스의 조정하는 방법은 크게 세가지가 있습니다.

#### 조정 방식
- 수동 조정
명시적으로 님이 하시면 됩니다.

- 조건 조정
인스턴스의 상태가 특정 조건을 만족했을 때 발동됩니다.

- 예약 조정
특정 시점에 도달했을 때 발동됩니다. 예약 조정은 단 한번만 일어나도록 설정할 수도 있고, 주기적으로 반복해서 일어나도록 설정할 수 있습니다.


#### 쿨다운 타임
오토스케일 상품을 지나치게 민감하게 설정하는 것은 현명한 일이 아닙니다.
가령 증감 정책의 기준을 낮게 잡으면 인스턴스가 계속 생성되어서 불필요한 과금이 발생합니다.
반대로 경감 정책의 기준을 너무 높게 잡는 경우 인스턴스가 유후 상태로 남아 불필요한 과금이 발생합니다.

추천드리는 방법은 증설을 신속하게 하고 감축은 천천히 하는 것입니다.
인스턴스들의 부하를 빨리 해소하고 안정적으로 서비스를 운영할 수 있습니다.

### 모니터링 지표
모니터링 지표는 이러이러한 것들이 있습니다.
오토스케일 상품은 각 지표들을 1분 주기로 수집합니다.
오토스케일 상품은 수집된 지표들을 1분 주기로 확인하여, 스케일링 그룹 단위로 평균값을 구합니다.

수집된 지표들은 스케일링 그룹 단위로 관리되며, 최종적으로 오토스케일 상품이 확인하는 값은 스케일링 그룹내 모든 인스턴스들의 평균 값입니다.
